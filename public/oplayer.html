<!DOCTYPE html>
<html>
<head>
  <title>Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .correct { background:#059669 !important; }
    .incorrect { background:#dc2626 !important; }
  </style>
</head>
<body class="bg-slate-950 text-white p-6">

<h1 class="text-2xl font-bold mb-4">PLAYER</h1>

<!-- Quiz Screen -->
<div id="quiz-screen" class="flex gap-6">

  <!-- Question & Options -->
  <div class="flex-1 space-y-4">
    <div id="q-text" class="bg-slate-800 p-4 rounded">Waiting...</div>

    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

    <div class="flex items-center gap-4">
      <span class="text-xl">Timer:</span>
      <span id="timer-text" class="text-2xl font-bold">60s</span>
    </div>

    <button id="submit-btn"
      class="bg-blue-600 px-4 py-2 rounded font-bold
             disabled:bg-slate-600
             disabled:text-slate-300
             disabled:cursor-not-allowed
             disabled:opacity-60
             transition-all"
      disabled>
      Submit Answer
    </button>
  </div>

  <!-- Leaderboard -->
  <div class="w-64 bg-slate-800 p-4 rounded">
    <h2 class="mb-2">Leaderboard</h2>
    <div id="rankings"></div>
  </div>
</div>

<!-- End Screen -->
<div id="end-screen" class="hidden text-center mt-6">
  <h2 class="text-4xl font-black">üèÜ Winner</h2>
  <div id="final-champ" class="text-6xl mt-4"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let playerName = prompt("Enter your name") || "Guest";
let currentIdx = 0;
let selectedIdx = null;
let canSubmit = false;

// Join Room
socket.emit("joinRoom", { name: playerName });

// Receive Question
socket.on("questionUpdate", ({ index, question }) => {
  currentIdx = index;
  selectedIdx = null;
  canSubmit = true;

  document.getElementById("q-text").innerText = question.q;
  document.getElementById("submit-btn").disabled = true;

  const grid = document.getElementById("options-grid");
  grid.innerHTML = "";

  question.o.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.className = "bg-slate-800 p-4 rounded";
    btn.onclick = () => selectOption(i, btn);
    grid.appendChild(btn);
  });
});

// Timer Update
<!-- Timer update -->
socket.on("timerUpdate", time => {
  document.getElementById("timer-text").innerText = `${time}s`;
  if (time <= 0) {
    canSubmit = false;
    document.getElementById("submit-btn").disabled = true;
    document.querySelectorAll("#options-grid button").forEach(b => b.disabled = true);
  }
});


// Leaderboard Update
socket.on("leaderboardUpdate", players => {
  const list = document.getElementById("rankings");
  list.innerHTML = "";
  Object.values(players).sort((a,b)=>b.score-b.score)
    .forEach(p => {
      list.innerHTML += `<div>${p.name}: ${p.score}</div>`;
    });
});

// Reveal Correct Answer
socket.on("revealAnswer", ({ correctIdx }) => {
  const buttons = document.querySelectorAll("#options-grid button");
  buttons.forEach((btn, i) => {
    btn.disabled = true;
    if (i === correctIdx) btn.classList.add("correct");
    else if (i === selectedIdx) btn.classList.add("incorrect");
  });
});

// Submit Answer
document.getElementById("submit-btn").onclick = () => {
  if (!canSubmit || selectedIdx === null) return;

  socket.emit("submitAnswer", {
    questionIdx: currentIdx,
    selectedIdx
  });

  canSubmit = false;
  document.getElementById("submit-btn").disabled = true;

  document.querySelectorAll("#options-grid button")
    .forEach(b => b.disabled = true);
};

// Select Option
function selectOption(idx, btn) {
  if (!canSubmit) return;

  selectedIdx = idx;

  document.querySelectorAll("#options-grid button")
    .forEach(b => b.classList.remove("bg-yellow-600"));

  btn.classList.add("bg-yellow-600");
  document.getElementById("submit-btn").disabled = false;
}

// Quiz Ended
socket.on("quizEnded", ({ players }) => {
  document.getElementById("quiz-screen").style.display = "none";
  document.getElementById("end-screen").classList.remove("hidden");
  const winner = Object.values(players).sort((a,b)=>b.score-b.score)[0];
  document.getElementById("final-champ").innerText = winner.name;
});
</script>
</body>
</html>
